<!DOCTYPE html>
<html>
<head>
  <title>Test Invoice Generation</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Test Invoice Generation</h1>
  <button onclick="testInvoice()">Test Invoice Creation</button>
  <pre id="result"></pre>

  <script>
    const supabase = window.supabase.createClient(
      'https://erlfsougrkzbgonumhoa.supabase.co',
      'YOUR_ANON_KEY_HERE' // Replace with your anon key
    );

    async function testInvoice() {
      const result = document.getElementById('result');
      result.textContent = 'Testing invoice generation...\n';

      try {
        // First, get a test professional
        const { data: professional, error: profError } = await supabase
          .from('professionals')
          .select('*')
          .eq('phone_number', '0533332543')
          .single();

        if (profError) {
          result.textContent += 'Error finding professional: ' + profError.message;
          return;
        }

        result.textContent += 'Found professional: ' + professional.name + '\n\n';

        // Call invoice function
        const { data, error } = await supabase.functions.invoke('tranzila-create-invoice', {
          body: {
            professional_id: professional.id,
            invoice_type: 'registration',
            total_amount: 1, // Test with 1 ILS
            description: 'דמי הרשמה - TEST - ' + professional.name
          }
        });

        if (error) {
          result.textContent += 'Error: ' + JSON.stringify(error, null, 2);
        } else {
          result.textContent += 'Success! Invoice created:\n' + JSON.stringify(data, null, 2);
        }

      } catch (err) {
        result.textContent += 'Exception: ' + err.message;
      }
    }
  </script>
</body>
</html>
